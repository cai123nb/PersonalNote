# 网络安全

`便利性`和`安全性`作为两个对立的特性兼容并存, 产生了很多新的技术.

## 网络安全构成的要素

TCP/IP 相关的安全要素如图所示:

![show](https://image.cjyong.com/blog/tcpip/175.png)

### 防火墙

在组织机构内部的网络与互联网相连时, 为了避免域内受到非法访问的威胁, 往往设置防火墙.

防火墙的种类很多种, 如, 专门过滤特定数据包的包过滤防火墙, 数据到达应用以后由应用处理并拒绝非法访问的应用网关. 这些防火墙都有基本相同的设计思路, 那就是`暴露给危险的主机和路由器的个数要有限`: 如果网路中 1000 台主机, 如果给每一个主机都设置非法访问的对策, 那就是非常繁琐的工作. 如果设置防火墙的话, 可以限制从互联网访问的主机个数, 并对这些主机进行专门的安全防护.

当从外部过来 TCP 通信请求, 只允许对 Web 服务器的 TCP80 端口和邮件服务器的 TCP25 端口的访问. 其他所有类型的包全部丢弃.此外, 建立 TCP 连接的请求只允许从内网发起(防火墙可以通过 TCP 包首部的 SYN 和 ACK 标志位拉实现, 当 SYN=1, ACK=0 时属于互联网发过来的包, 就可以废弃了).

![show](https://image.cjyong.com/blog/tcpip/176.png)

### IDS(入侵检测系统)

只有符合安全策略的数据包才可以通过. 但是对于符合条件的数据包, 无法判断是否是非法访问, 而 IDS 正是检查这种已经侵入内部网络进行非法访问的情况, 并及时通知给网络管理员的系统. IDS 根据不同的用途可以提供各种不同的功能, 从设置的形式上看, 一般在防火墙或者 DMZ 等边界设备上进行设置, 有了这样监控, 检测边界的功能, 就可以设置网络内部, 全网或个别特殊服务器进行监控. 从功能上看, IDS 有定期采集日志, 长期监控, 通知异常等功能. 它可以监控网络上流动的所有数据包, 确保不同系统的安全.

### 反病毒/个人防火墙

它们往往是用户计算机或服务器上运行的软件, 既可以监控计算机中进出的所有包和数据,文件, 也可以防止对计算机的异常操作和病毒入侵.

## 加密技术基础

为了防止信息传递过程中的泄漏, 出现了各种各样的加密技术.

![show](https://image.cjyong.com/blog/tcpip/177.png)

### 对称密码体制和公钥密码体制

加密是指利用某个值(密钥)对明文进行一定算法的变换成加密数据(密文)的过程. 它的逆反过程叫做解密.

加解密使用相同的密钥叫做对称加密方式(如 AES, Advanced Encryption Standard, DES, Data Encryption Standard). 如果不同, 称为公钥加密方式(如 RSA, DH, Diffie-Hellman, 椭圆曲线等).

### 身份认证技术

- 密码或私有代码(私有识别码)
- 拥有的信息: ID 卡, 密钥, 电子证书, 电话号码等.
- 独一无二的体态特征: 指纹, 视网膜等个人特有的生物特征进行认证.

从认证级别和成本效益考虑, 一般会综合上述 3 种方式进行. 另外还有一种集合各种终端, 服务器和应用的认证与一起的进行综合管理的技术叫做 IDM(IDentity Managment).

## 安全协议

### IPsec 和 VPN

为了防止信息泄露, 对机密数据的传输一般不使用互联网等公共网络(Public Network), 而是使用由专线连接的私有网络(Private Network), 从而从物理上杜绝了窃听和修改数据的可能. 然而专线的造价太高是一个难以避免的问题.

为了解决这个问题, 人们想到了一个在互联网上构造虚拟的私有网络, 即 VPN(Virtual Private Network,虚拟专用网). 互联网采用加密和认证技术可以达到`即使读取到了数据也没办法读懂`, `检查是否被篡改`等功能.

构建 VPN 最常使用的就是 IPsec, 在 IP 首部后面追加`封装安全有效载荷(Encapsulating Security Payload)`和`认证首部(Authentication Header)`, 并对后面的数据进行加密, 防止被盗取者使用.

![show](https://image.cjyong.com/blog/tcpip/178.png)

### TLS/SSL 与 HTTPS

在人们使用网上购物或者网上订车票等支付过程中往往涉及到网上支付账号密码等关键信息, 因此在网络上传输这些信息时, 有必要对它们进行加密处理. Web 可以使用 TLS/SSL 对 HTTP 通信进行加密. 使用 TLS/SSL 的 HTTP 通信叫做 HTTPS 通信. HTTPS 采用对称加密方式, 而传递公共密钥时采用的是公钥加密方式.

![show](https://image.cjyong.com/blog/tcpip/179.png)

流程: 服务器端将自己的公钥交给 CA 进行签名(CA 使用自己的私钥进行加密)生成电子证书(之所以需要 CA 是为了防止公钥传输过程中别人篡改), 当用户发起连接请求时, 将自己的电子证书发送给用户, 用户的浏览器中内置了所有权威 CA 的公钥进行解密获得服务器端的公钥, 生成一个公共密钥进行加密, 并将一份信息使用公共密钥进行加密发送给服务端, 服务端使用自己的私钥进行解密获得公共密钥, 使用公共密钥进行解密信息, 发送回客户端进行校验. 校验成功, 二者使用公共密钥进行加密传输.

### IEEE802.1X

IEEE802.1X 是为了可以对接入 LAN 交换机和无线 LAN 接入点的用户进行认证的技术.一般由客户端终端, AP(无线基站)以及认证服务器组成.

IEEE802.1X 中当有一个尚未认证的终端连接 AP,起初无条件让其连接到 VLAN, 获取临时的 IP 地址. 然而此时终端只能连接认证服务器. 用户被要求输入用户名和密码, 认证服务器收到信息之后, 将该用户可以访问的网络信息通知给 AP 和终端. 随后 AP 会进行 VLAN 号码的切换. 终端由于 VLAN 的切换进行 IP 地址的重置得以连接网络.

![show](https://image.cjyong.com/blog/tcpip/180.png)
