# 网络基础知识

## 从独立模式到网络互连模式

起初, 计算机以单机模式被广泛使用(亦称`独立模式`), 然而随着计算机的不断发展, 人们不再局限于`单机模式`, 而是将一个个计算机连在一起, 形成一个计算机网络. 计算机网络, 视其规模可以分为`WAN`(Wide Area Network, 广域网)和`LAN`(Local Area Network, 局域网).

## 计算机与网络发展的7个阶段

1. **批处理**: 为了可以让更多人使用计算机, 出现了`批处理(Batch Processing)系统`. 指事先将用户程序和数据装入卡带或磁带, 并由计算机按照一定的顺序读取, 使用户所要执行的这些程序和数据能够一并批量得到处理的方式.
2. **分时系统**: 20世纪60年代出现了`分时系统(TSS, Time Sharing System)`. 指多个终端与同一个计算机连接, 运行多个用户同时使用一台计算机的系统. 由于当时计算机造价非常昂贵, 一人一台专有计算机的费用对一般人来说过于昂贵, 使用分时系统,可以让多个人同时使用同一台计算机, 但是感觉'完全就是自己在使用一台计算机一样'.
3. **计算机通信时代**: 在计算机间的通信技术诞生之前, 想要将一台计算机中的数据转移到另一台计算机中是相当繁琐的, 需要将数据保存到磁带, 软盘等外部存储介质中, 然后将这些介质送到目的计算机中才能实现数据转储. 然而有了计算机间的通信技术, 人们可以很轻松地即时读取另一台计算机中的数据, 大大缩短了传送数据的时间.
4. **计算机网络时代**: 计算机之间的连接不仅仅是单纯的连接, 更是产生了一种可以互连多种计算机的网络: 计算机网络.
5. **互联网的时代**: 计算机网络进一步发展, 成就了互联网时代的诞生.
6. **互联网为中心时代**: 随着互联网的普及, 联网的设备不仅仅局限于计算机, 更是拓展到生活中的方方面面.
7. **TCP/IP时代**: 随着互联网的发展, 安全意识不断增强, 人们不再单纯地满足`建立连接`, 而是更加追求`安全的建立连接`.

## 协议

`协议`就是计算机与计算机之间通过网络通信时事先达成的一种`约定`. 协议可以分为很多种, 每一种协议都明确地界定了它的行为规范. 在互联网中具有代表性的协议有IP,TCP,HTTP等等. 而LAN(局域网)中常用的协议有IPX/SPX等.

## 协议有谁进行规定

在计算机发展的初期, 不同厂商提供自己的不同协议, 这就导致不同公司之间的交流无法进行. 为了解决兼容性的问题, `ISO(国际标准化组织, International Organization for Standards)`制定了一个国际标准`OSI(Open System Interconnection, 开放式通信系统互联网参考模型)`, 对通信系统进行了标准化. 这里TCP/IP并不是由ISO所制定的某种国际标准. 而是由`IETF(Internet Engineering Task Force)` 所建议的, 致力于推进其标准化作业的一种协议.

## 协议分层与OSI参考模型

ISO在指定标准化OSI之前, 对网络体系结构相关问题进行了充分的讨论, 最终提出了作为通信协议设计指标的OSI参考模型. OSI参考模型将通信协议中必要的功能分层了7层: `物理层`, `数据链路层`, `网络层`, `传输层`, `会话层`, `表示层`, `应用层`. 每个分层都接收由它下一层所提供的特定服务, 并且负责为自己的上一层提供特定的服务. 上下层之间进行交互时所遵守的约定叫做`接口`. 同一层之间的交互所遵循的约定叫做`协议`.

这里我们使用通话的例子来展示:

![show](https://image.cjyong.com/blog/tcpip/1.png)

这里简单说明OSI参考模型中各个分层的主要作用:

| 分层位置 | 分层名称  | 功能                                       | 功能概览                                    |
|:-----|:------|:-----------------------------------------|:----------------------------------------|
| 7    | 应用层   | 针对特定应用的协议                                | 针对每个应用的协议如, 电子邮件: 电子邮件协议;远程登录: 远程登录协议等等 |
| 6    | 表示层   | 设备固有数据格式和网络标准数据格式的转换.                    | 接受不同表现形式的信息, 如文字流, 图像, 声音等等             |
| 5    | 会话层   | 通信管理. 负责建立和断开通信连接(数据流动的逻辑通路). 管理传输层一下的分层 | 何时建立连接, 何时断开连接以及保持多久的连接?                |
| 4    | 传输层   | 管理两个节点之间的数据传输. 负责可靠传输(确保数据被可靠地传送到目标地址).  | 是否有数据丢失?                                |
| 3    | 网络层   | 地址管理和路由选择.                               | 经过那个路由传递到目标地址 ?                         |
| 2    | 数据链路层 | 互连设备之间传送和识别数据帧                           | 数据帧与比特流之间的转换                            |
| 1    | 物理层   | 0,1代表电压的高低, 灯光的闪灭. 界定连接器和网线的规格           | 比特流与电子信号之间的切换, 连接器与网线的规格                |

## 传输方式的分类

网络与通信可以根据其数据发送方法进行多种分类. 分类方法也很多:

### 面向有连接型与面向无连接型

**面向有连接型**: 在发送数据之前, 需要在收发主机之间连接一条通信线路.如常用的TCP协议.

**面向无连接型**: 不要求建立和断开连接. 发送端可以在任何时候自由发送数据. 反之接收端也永远不知道什么时候可以接收到数据, 因此需要, 时常确认是否接收到了数据. 如UDP协议.

![show](https://image.cjyong.com/blog/tcpip/2.png)

### 电路交换与分组交换

目前网络通信的方式主要分为两种: 电路交换和分组交换. 电路交换的技术较为久远, 常见于以前的电话网. 而分组交换则是较为新的技术, 如TCP/IP采用.

**电路交换**:  主要是通过交换机进行中转处理. 每个交换机之间有很多通信线路连接, 计算机需要先连接到交换机上, 并通过交换机与目标主机建立连接. 当电路连接完毕, 就是建立好了连接, 用户就可以一直使用这条线路直到断开, 但是这时候别人就无法使用这条线路.

**分组交换**: 由于交换机之间线路有限, 常常没办法满足需求. 这时候人们就想到了一个新方法, 将需要发送的数据分成多个数据包依次发送(就不用一直占据线路), 数据包上写好发送端和接收端的地址. 这样即使只有一条线路也可以为多个人提供服务.

![show](https://image.cjyong.com/blog/tcpip/3.png)

### 根据接收端数量进行分类

**单播(Unicast)**: 1对1通信.

**广播(Broadcast)**: 一台主机发送给与之相连的其他主机. 如电视信号一样.

**多播(Multicast)**: 多播类似广播, 也是将消息发送给多个主机, 但是需要限定某一组主句作为接收端. 如电视会议, 需要确定是谁在哪参加电视会议.

**任播(Anycast)**: 在特定的多台主机中选出一台作为接收端的通信方式. 常见于DNS根域名服务器.

![show](https://image.cjyong.com/blog/tcpip/4.png)

## 地址

通信传输中, 发送端和接收端可以被视为通信主体. 它们都能由一个所谓`地址`的信息加以标识出来。 在计算机通信中, 这种地址的概念显得比较复杂. 因为在实际的网络通信当中, 每一层的协议所使用的地址都不尽相同。 如在TCP/IP通信中使用MAC地址, IP地址, 端口号作为地址标识. 在应用层中, 可以将电子邮件地址作为网络通信地址.

### 地址的唯一性

如果想让地址在通信当中发挥作用, 首先需要确定通信的主体. 一个地址必须明确地表示一个主体对象. 在同一个通信网络中不允许有两个相同地址的通信主体.

### 地址的层次性

当地址总数并不是很多的情况下, 有了唯一地址就可以定位相互通信的主体.然而, 当地址的总数越来越多, 如何高效地从中找出通信的目标地址将成为一个重要的问题.为此人们发现地址除了具有唯一性还需要具有层次性.

MAC地址和IP地址可以标识一个通信主体的唯一性, 但是只有IP地址具有层次性. MAC地址由设备的制造厂商针对每块网卡(NIC, Network Interface Card)进行分别确定. 但是人们没有办法确定网卡使用在那个地方.
因此是由IP地址进行分层.

IP地址由网络号和主机号两部分组成. 只要网络号相同, 说明它们处于同一个网段. 通常, 同处一个网段的主机也都属于同一个部门或集团组织. 在网络传输中, 每个节点会根据分组数据的地址信息, 来判断该报文应该由那个网卡发送出去. 为此, 各个地址会参考一个发出接口列表. 类似MAC寻址和IP寻址. MAC寻址中参考的表叫做地址转发表, IP寻址中参考的是路由控制表.  MAC地址转发表中所记录的是实际的MAC地址本身, 而路由表记录的IP地址则是集中了之后的网络号.

![show](https://image.cjyong.com/blog/tcpip/5.png)

## 网络的构成要素

![show](https://image.cjyong.com/blog/tcpip/7.png)

### 中继器

中继器(Repeater)是在OSI模型的第一层, 物理层面上延长网络的设备. 由电缆传过来的电信号或光信号经由中继器的波形调整和放大再传给另一个电缆.

![show](https://image.cjyong.com/blog/tcpip/6.png)

一般情况下中继器两端都是相同的通信媒介, 但是有的中继器可以完成不同通信媒介之间的转换,, 但是中继器只是单纯的放大信号(负责信号在0和1比特流中进行替换), 并不会对数据进行检查判断是否有错. 并且中继器的延长并不能无限延长, 如10Mbps的以太网最多使用4个中继器分段连接, 而100Mbps的以太网只能使用两个中继器. 某些中继器提供多个端口服务, 这种中继器称为集线器.

### 网桥/2层交换机

![show](https://image.cjyong.com/blog/tcpip/8.png)

网桥是OSI模型的第二层, 数据链路层面上连接两个网络的设备. 它可以识别数据链路层中的数据帧, 并将这些数据帧临时存储于内存, 再重新生成信号作为一个全新的帧转发给相连的另一个网段. 由于可以存储这些数据帧, 网桥可以连接10BASE-T与100BASE-TX等传输效率完全不同的数据链路, 并且不限制连接网段的个数.

数据链路的数据帧中有一个数据位叫做FCS(通过CRC<Cyclic Predurdancy Check, 循环冗余校验码>方式校验数据帧中的位), 用以校验数据是否正确送达目的地. 网桥通过校验这个域中的值, 将那些损坏的数据丢弃, 避免再次发送给其他网段. 网桥还能通过地址自学机制和过滤功能控制网络流量.

这类功能时OSI参考模型的第2层(数据链路层)所具有的功能. 因此, 网桥称作2层交换机.

![show](https://image.cjyong.com/blog/tcpip/9.png)

以太网等网络中经常使用的交换集线器(Hub), 现在基本也属于网桥的一种. 交换集线器中连接电缆的每个端口都能提供类似网桥的功能.

### 路由器/3层交换机

![show](https://image.cjyong.com/blog/tcpip/10.png)

路由器是在OSI模型的第3层, 网络层面上连接两个网络, 并对分组报文进行转发的设备. 网桥是根据物理地址(MAC地址)进行处理, 而路由器/3层交换机是通过IP地址进行处理. 路由器可以连接不同的数据链路. 如连接两个以太网, 或者连接一个以太网和一个FDDI, 如我们现在使用的宽带路由器就是路由器的一种.

### 4-7层交换机

4-7层交换机负责OSI模型中从传输层到应用层的数据. 如果使用TCP/IP分层模型来表述, 4-7层交换机就是以TCP等协议的传输层及其上面的应用层为基础, 分析收发数据, 并对其进行特定的处理. 如, 对于一个并发访问量非常大的企业级Web站点, 使用一台服务器不足以满足前端的访问要求, 这是需要架设多台服务器来分担. 这些前端服务器的访问入口通常只有一个(同一个URL地址). 为了可以通过同一个URL将前端访问分发到后台多个服务器上, 可以在这些服务器的前端加一个负载均衡器. 这种负载均衡器就是4-7层交换机的一种.

并且, 实际通信时, 如果网络比较拥堵, 优先处理像语音这类对及时性要求较高的通信请求, 放缓处理邮件或数据转发等稍有延迟也没有大碍的通信请求. 这种处理称为带宽控制. 类似的功能还有很多: 广域网加速器, 特殊应用访问加速已经防火墙等等.

### 网关

![show](https://image.cjyong.com/blog/tcpip/11.png)

网关是OSI参考模型中负责将传输层到应用层的数据进行转换和转发的设备. 如互联网邮件和手机邮件之间的转换服务. 手机邮件有时可能不会与互联网邮件兼容, 这就是由于它们在表示层和应用层中的"电子邮件协议"不同导致的.

但是这时候, 我们可以在互联网电脑和手机之间添加一道网关. 负责读取不同的协议, 并进行统一的处理和转换, 再将数据发送出去.

![show](https://image.cjyong.com/blog/tcpip/12.png)

另外还有代理服务器也是典型的网关的一种, 可以通过代理服务器进行安全验证和流量控制.

![show](https://image.cjyong.com/blog/tcpip/13.png)

总结:

![show](https://image.cjyong.com/blog/tcpip/14.png)

## 现代网络

### 互联网通信

![show](https://image.cjyong.com/blog/tcpip/15.png)

### 移动通信

![show](https://image.cjyong.com/blog/tcpip/16.png)

